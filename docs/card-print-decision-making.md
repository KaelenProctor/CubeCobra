# Cards and printings

Cards within CubeCobra have a few different identifiers that can be used:

- Scryfall id - A unique identifier of a specific printing of a card
- Oracle id - A shared identifier across all printings of a card
- Name - The English name. A different shared identifier across all printings of a card. As well, can indicate multiple cards for split cards using `//`, eg `Fire // Ice`

For more details of these read the [Scryfall API for Cards](https://scryfall.com/docs/api/cards).

Based on the above if there is a search for a card based on Oracle id or Name, that will result in a set of Card printings with unique Scryfall ids. The two data structures that support these mappings are the `private/oracleToId.json` and `private/nameToId.json` files. Those files are generated by the Update cards job in [update_cards.ts](../src/jobs/update_cards.ts).

So how do we determine which printing to display to the user?

## How the print of a card is determined

There are two factors at play to determine the chosen card printing:

1. The "Reasonableness" of a print
2. Printing preference configuration

The "Reasonableness" of a print is a function that filters the possible printings of a card, excluding cards that are not reasonable. The printing preference applies afterwards, and is currently more of a sorting function than a filter but that could change in the future.

### What is a "Reasonable" card?

The reasonable filter does not have a hard and fast definition. It does it's best to filter out non-standard printings of cards using a variety of checks, but it may not match each individual's perception.

The function itself is `reasonableCard` in [cardutil.ts](../src/client/utils/cardutil.ts). It depends on the Update cards logic in [update_cards.ts](../src/jobs/update_cards.ts) especially for the `isExtra` field which CubeCobra adds on top of the Scryfall Card fields.

Here is a short summary of what a reasonable card strives to be:

- Not a token
- Not a digital only card
- Not a gold border card
- Not a promo card
- Not an art series card
- English only cards
- Has a TCGPlayer id

Diving deeper into what is a "promo card" means. A printing is tagged as promo if:

- Scryfall defines it has a promo
- Textless prints
- Extended art or showcase prints
- Art series
- From a "masterpiece" set
- Is part of groups such as booster fun (see https://magic.wizards.com/en/news/making-magic/project-booster-fun-2019-07-20), Playtest/Mystery booster, prerelease / championship promos, special foils, and more!

Defining what a promo is tends to be more art than science, as there are so many exceptions coming from WotC / Scryfall.

### Printing preferences

Both user's and cube's can set the default printing preference. After the reasonable filter applies, the printing preference is used to determine the specific print to use. The logic for this lives within the `getMostReasonableByPrintingPreference` function in [carddb.ts](../src/util/carddb.ts).

The two options currently are:

1. First printing
2. Most recent printing

To apply these preferences the printings are ordered based on the Card details `released_at` and `collector_number` fields. `released_at` is a date string in the YYYY-MM-DD format. `collector_number` is a string field (not a number!). Both of these sorts are done via the Sorting functions in [Sort.ts](../src/client/utils/Sort.ts) (see `SortFunctions`) to be consistent with the sorting user's can do in the UI.
